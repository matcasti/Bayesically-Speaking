<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Matías Castillo-Aguilar">
<meta name="dcterms.date" content="2025-01-06">
<meta name="description" content="Action potentials are the language of neurons. In this post we build a simplified model to explain how these electrical signals are generated. We’ll explore the role of ion channels and build an intuitive understanding of neuronal firing.">

<title>Decoding the Neuron’s Spark: Building Intuition for Action Potential Dynamics – Bayesically Speaking</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-H5JH00934M"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-H5JH00934M', { 'anonymize_ip': true});
</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(title-block.jpeg);
background-size: cover;
      }
</style>
<meta name="quarto:status" content="draft">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta name="citation_title" content="Decoding the Neuron&amp;amp;#039;s Spark: Building Intuition for Action Potential Dynamics">
<meta name="citation_author" content="Matías Castillo-Aguilar">
<meta name="citation_publication_date" content="2025-01-06">
<meta name="citation_cover_date" content="2025-01-06">
<meta name="citation_year" content="2025">
<meta name="citation_online_date" content="2025-01-06">
<meta name="citation_fulltext_html_url" content="https://bayesically-speaking.com/posts/2025-01-06 simulating-action-potential/">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=Robbins basic pathology e-book;,citation_author=Vinay Kumar;,citation_author=Abul K Abbas;,citation_author=Jon C Aster;,citation_publication_date=2012;,citation_cover_date=2012;,citation_year=2012;">
<meta name="citation_reference" content="citation_title=Clinical cancer immunotherapy: Current progress and prospects;,citation_author=Chenglong Liu;,citation_author=Mengxuan Yang;,citation_author=Daizhou Zhang;,citation_author=Ming Chen;,citation_author=Di Zhu;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_volume=13;,citation_journal_title=Frontiers in immunology;,citation_publisher=Frontiers Media SA;">
<meta name="citation_reference" content="citation_title=Metabolic competition in the tumor microenvironment is a driver of cancer progression;,citation_author=Chih-Hao Chang;,citation_author=Jing Qiu;,citation_author=David O’Sullivan;,citation_author=Michael D Buck;,citation_author=Takuro Noguchi;,citation_author=Jonathan D Curtis;,citation_author=Qiongyu Chen;,citation_author=Mariel Gindin;,citation_author=Matthew M Gubin;,citation_author=Gerritje JW Van Der Windt;,citation_author=others;,citation_publication_date=2015;,citation_cover_date=2015;,citation_year=2015;,citation_issue=6;,citation_volume=162;,citation_journal_title=Cell;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Cancer immunotherapy: Challenges and limitations;,citation_author=Sina Taefehshokr;,citation_author=Aram Parhizkar;,citation_author=Shima Hayati;,citation_author=Morteza Mousapour;,citation_author=Amin Mahmoudpour;,citation_author=Liliane Eleid;,citation_author=Dara Rahmanpour;,citation_author=Sahand Fattahi;,citation_author=Hadi Shabani;,citation_author=Nima Taefehshokr;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_volume=229;,citation_journal_title=Pathology-Research and Practice;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=T cell antigen discovery;,citation_author=Alok V Joglekar;,citation_author=Guideng Li;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_issue=8;,citation_volume=18;,citation_journal_title=Nature methods;,citation_publisher=Nature Publishing Group US New York;">
<meta name="citation_reference" content="citation_title=Intercellular receptor-ligand binding: Effect of protein-membrane interaction;,citation_author=Long Li;,citation_author=Jing Ji;,citation_author=Fan Song;,citation_author=Jinglei Hu;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_issue=1;,citation_volume=435;,citation_journal_title=Journal of Molecular Biology;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Role of t cell-to-dendritic cell chemoattraction in t cell priming initiation in the lymph node: An agent-based modeling study;,citation_author=Ivan Azarov;,citation_author=Kirill Peskov;,citation_author=Gabriel Helmlinger;,citation_author=Yuri Kosinsky;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_volume=10;,citation_journal_title=Frontiers in immunology;,citation_publisher=Frontiers Media SA;">
<meta name="citation_reference" content="citation_title=Challenges, tasks, and opportunities in modeling agent-based complex systems;,citation_author=Li An;,citation_author=Volker Grimm;,citation_author=Abigail Sullivan;,citation_author=BL Turner Ii;,citation_author=Nicolas Malleson;,citation_author=Alison Heppenstall;,citation_author=Christian Vincenot;,citation_author=Derek Robinson;,citation_author=Xinyue Ye;,citation_author=Jianguo Liu;,citation_author=others;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_volume=457;,citation_journal_title=Ecological Modelling;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Antigen potency and maximal efficacy reveal a mechanism of efficient t cell activation;,citation_author=Omer Dushek;,citation_author=Milos Aleksic;,citation_author=Richard J Wheeler;,citation_author=Hao Zhang;,citation_author=Shaun-Paul Cordoba;,citation_author=Yan-Chun Peng;,citation_author=Ji-Li Chen;,citation_author=Vincenzo Cerundolo;,citation_author=Tao Dong;,citation_author=Daniel Coombs;,citation_author=others;,citation_publication_date=2011;,citation_cover_date=2011;,citation_year=2011;,citation_issue=176;,citation_volume=4;,citation_journal_title=Science signaling;,citation_publisher=American Association for the Advancement of Science;">
<meta name="citation_reference" content="citation_title=Deconvolution of clinical variance in CAR-t cell pharmacology and response;,citation_author=Daniel C Kirouac;,citation_author=Cole Zmurchok;,citation_author=Avisek Deyati;,citation_author=Jordan Sicherman;,citation_author=Chris Bond;,citation_author=Peter W Zandstra;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_issue=11;,citation_volume=41;,citation_journal_title=Nature Biotechnology;,citation_publisher=Nature Publishing Group US New York;">
<meta name="citation_reference" content="citation_title=Cooperative binding;,citation_author=Melanie I Stefan;,citation_author=Nicolas Le Novère;,citation_publication_date=2013;,citation_cover_date=2013;,citation_year=2013;,citation_issue=6;,citation_volume=9;,citation_journal_title=PLoS computational biology;,citation_publisher=Public Library of Science San Francisco, USA;">
<meta name="citation_reference" content="citation_title=Tissue-resident memory t cells in mice and humans: Towards a quantitative ecology;,citation_author=Sinead E Morris;,citation_author=Donna L Farber;,citation_author=Andrew J Yates;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_issue=10;,citation_volume=203;,citation_journal_title=The Journal of Immunology;,citation_publisher=American Association of Immunologists;">
<meta name="citation_reference" content="citation_title=Extended logistic growth model for heterogeneous populations;,citation_author=Wang Jin;,citation_author=Scott W McCue;,citation_author=Matthew J Simpson;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_volume=445;,citation_journal_title=Journal of Theoretical Biology;,citation_publisher=Elsevier;">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><div id="quarto-draft-alert" class="alert alert-warning"><i class="bi bi-pencil-square"></i>Draft</div>
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Bayesically Speaking</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../services.html"> 
<span class="menu-text">Services</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cv.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/matcasti"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/matias_science"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../blog.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Decoding the Neuron’s Spark: Building Intuition for Action Potential Dynamics</h1>
                  <div>
        <div class="description">
          <p>Action potentials are the language of neurons. In this post we build a simplified model to explain how these electrical signals are generated. We’ll explore the role of ion channels and build an intuitive understanding of neuronal firing.</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">non-linear</div>
                <div class="quarto-category">neuroscience</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://bayesically-speaking.com/cv">Matías Castillo-Aguilar</a> <a href="mailto:m99castillo@gmail.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0001-7291-247X" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 6, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">





<section id="introduction" class="level1 page-columns page-full">
<h1>Introduction</h1>
<p>Ever wondered how your brain manages to tell your hand to grab that slice of pizza before your roommate does? It’s all thanks to an incredibly complex, yet surprisingly efficient communication network, your nervous system. Think of it as the internet of your body, but instead of cat videos and online shopping, it’s buzzing with urgent messages about survival (like pizza acquisition) and other important stuff, like not walking into walls.</p>
<p>This network relies on specialized cells called neurons, which are basically your body’s tiny gossips. They constantly chatter with each other, passing along information in the form of rapid electrical signals called action potentials. These aren’t your grandma’s static shocks; they’re more like carefully crafted Morse code messages, zipping along neural pathways at impressive speeds. Imagine each neuron as a tiny town crier, shouting the latest news (or sensory input) to the next town over.</p>
<p>Now, you might be thinking, “Electrical signals? Sounds complicated.” And you’d be right. But fear not! In this post, we’re going to break down the magic behind action potentials using a simplified mathematical model. Think of it as a cheat sheet for understanding how these tiny electrical storms work. We’ll start with the basics and gradually add complexity, like adding extra gossip to the town crier’s message, until we have a decent understanding of the dynamics at play. No PhD in neuroscience required (though a craving for pizza is always helpful). So, buckle up, because we’re about to drive into the electrifying world of neuronal communication!</p>
<div class="page-columns page-full"><p><img src="action-potential-neuron.png" class="img-fluid" style="width:100.0%"> </p><div class="no-row-height column-margin column-container"><span class="margin-aside">Photo from <a href="https://www.britannica.com/science/action-potential">Encyclopaedia Britannica</a></span></div></div>
</section>
<section id="the-neuron-as-a-simple-circuit-a-first-approximation" class="level1 page-columns page-full">
<h1>The Neuron as a Simple Circuit: A First Approximation</h1>
<p>Let’s imagine our neuron not as a bustling town crier, but as a tiny, slightly bored house. It’s got walls (the cell membrane), an inside (intracellular fluid), and an outside (extracellular fluid). These fluids are salty solutions, full of charged particles called ions like sodium, potassium, and chloride (the electrolyte gang you see advertised in sports drinks). Now, because these fluids have different concentrations of these ions, there’s a difference in electrical charge between the inside and the outside of the house. This difference in charge is what we call the <em>membrane potential</em>, measured in millivolts (mV). Think of it like a tiny battery inside the neuron, just waiting to be used.</p>
<p>Normally, this “battery” sits at a resting voltage of around -70 mV. Why negative? It’s just a convention: we define the outside of the cell as zero, and the inside is negatively charged relative to it. So, our little neuron house is just chilling, with a slight negative charge inside (like a grumpy teenager refusing to get out of bed).</p>
<p>Now, our neuron’s walls (the membrane) aren’t completely airtight. They have tiny holes, called <em>leak channels</em>, which allow some ions to slowly trickle in and out. It’s like having a slightly leaky faucet, not a major flood, but a constant drip. These leaks are crucial because they maintain that resting membrane potential.</p>
<div class="page-columns page-full"><p><img src="leakage-channels.jpg" class="img-fluid" style="width:100.0%"> </p><div class="no-row-height column-margin column-container"><span class="margin-aside">Photo from <a href="https://ecampusontario.pressbooks.pub/neurosciencecdn/chapter/anatomy-physiology-the-nervous-system-and-nervous-tissue/">Neuroscience: Canadian 1st Edition</a></span></div></div>
<p>Another important property of the membrane is its ability to store electrical charge, much like a capacitor in an electronic circuit. This is called <em>capacitance</em>. Imagine the membrane as two conductive plates (the inside and outside of the cell) separated by an insulator (the membrane itself). When there’s a difference in charge across the membrane (our membrane potential), it stores some of that charge. It’s like a tiny electrical reservoir, ready to release its charge when needed.</p>
<p>So, to summarize our lazy neuron house:</p>
<ul>
<li><strong>Membrane potential:</strong> A voltage difference between the inside and outside.</li>
<li><strong>Leak channels:</strong> Tiny holes that allow ions to slowly leak across the membrane, maintaining the resting potential.</li>
<li><strong>Capacitance:</strong> The membrane’s ability to store electrical charge.</li>
</ul>
<section id="expanding-our-intuition-using-math-waking-up-the-sleeping-neuron" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="expanding-our-intuition-using-math-waking-up-the-sleeping-neuron">Expanding our Intuition Using Math: Waking Up the Sleeping Neuron</h4>
<p>Right now, our neuron is basically a zombie. It’s just sitting there, leaking a bit of charge and generally being a bit of a slacker. No exciting messages, no action potentials, it’s like a town crier who’s decided to take an eternal nap. But fear not! Things are about to get much more interesting. We’re about to introduce the real heroes of the story: voltage-gated ion channels.</p>
<div class="page-columns page-full"><p><img src="voltage-dependent-channels.jpeg" class="img-fluid" style="width:100.0%"> </p><div class="no-row-height column-margin column-container"><span class="margin-aside">Photo from <a href="https://ecampusontario.pressbooks.pub/neurosciencecdn/chapter/anatomy-physiology-the-nervous-system-and-nervous-tissue/">Neuroscience: Canadian 1st Edition</a></span></div></div>
<p>Now, let’s get a little mathematical here (don’t worry, we’ll keep it fun!). We need a function to describe how the membrane potential (<span class="math inline">\(V\)</span>) changes over time (<span class="math inline">\(t\)</span>) due to all that pesky leakage.</p>
<p>So, what kind of function would you use to describe something that decays gradually, like a deflating balloon? You guessed it! We need an exponential function, that classic workhorse of mathematical modeling.</p>
<p>Exponential functions look something like this:</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>input <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">8</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">input =</span> input,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">e^x</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(input),</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">-e^x</span><span class="st">`</span> <span class="ot">=</span> <span class="sc">-</span><span class="fu">exp</span>(input),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">e^{-x}</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(<span class="sc">-</span>input),</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">-e^{-x}</span><span class="st">`</span> <span class="ot">=</span> <span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>input))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">melt</span>(df, <span class="at">id.vars =</span> <span class="st">"input"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(input, value)) <span class="sc">+</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> variable, <span class="at">labeller =</span> <span class="st">"label_parsed"</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>, </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">col =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Input"</span>, <span class="at">y =</span> <span class="st">"Output"</span>,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Exponential Function Dynamics"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="index_files/figure-html/unnamed-chunk-2-1.svg" class="img-fluid figure-img"></p>
<figcaption class="margin-caption"><strong>Exponential Function and Common Variations</strong>. Here we see how changing a small detail in the original function (in this case a negative sign) can yield dramatically different behavior.</figcaption>
</figure>
</div>
</div>
</div>
<p>At first glance, we can see that the bottom variations of the exponential function (the ones with negative exponents) seem to behave more like a neuron should. They oscillate nicely, staying within a reasonable range. This function with the negative exponent, <span class="math inline">\(e^{-x}\)</span>, seems like a good starting point to describe how the membrane potential gradually returns to its resting state. It’s like watching a deflating balloon (slow and steady).</p>
</section>
<section id="customizing-it-further-tweaking-the-decay-rate" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="customizing-it-further-tweaking-the-decay-rate">Customizing It Further: Tweaking the Decay Rate</h4>
<p>Now, let’s get a little more creative! We can tweak this function to control how quickly the membrane potential returns to rest. Imagine it’s like adjusting the valve on a tire, you can control how fast the air leaks out.</p>
<p>We can do this by adding a “rate parameter” to our exponent. Instead of just <span class="math inline">\(e^{-x}\)</span>, we can use <span class="math inline">\(e^{-x \cdot \lambda}\)</span>. This <span class="math inline">\(\lambda\)</span> value acts like a speed control for the decay. By changing <span class="math inline">\(\lambda\)</span>, we can adjust how quickly the membrane potential returns to its resting value. It’s like having a dial to control how fast the balloon deflates.</p>
<p>Let’s visualize this change and see how it affects the decay rate!</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>input <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="at">X =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.4</span>, <span class="at">by =</span> <span class="fl">0.2</span>), <span class="cf">function</span>(x) {</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>(<span class="at">Input =</span> input, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">lambda =</span> <span class="fu">format</span>(x, <span class="at">digits =</span> <span class="dv">1</span>, <span class="at">nsmall =</span> <span class="dv">1</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">Output =</span> <span class="fu">exp</span>(<span class="sc">-</span>input <span class="sc">*</span> x))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span> <span class="fu">rbindlist</span>()</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(Input, Output, <span class="at">color =</span> <span class="fu">ordered</span>(lambda))) <span class="sc">+</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="fu">expression</span>(lambda),</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(e<span class="sc">^</span>{<span class="sc">-</span>x<span class="sc">*</span>lambda}),</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(<span class="st">"Rate Parameter ("</span><span class="sc">*</span>lambda<span class="sc">*</span><span class="st">") on Output Dynamics"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="index_files/figure-html/unnamed-chunk-3-1.svg" class="img-fluid figure-img"></p>
<figcaption class="margin-caption"><strong>Effect of Rate Parameter on Function Dynamics</strong>. Here we see that by altering the rate parameter <span class="math inline">\(\lambda\)</span> we can toy around with “how fast” our exponential function is returning to baseline.</figcaption>
</figure>
</div>
</div>
</div>
<p>Great! Now we need to give this function a little personality. Right now, it’s a bit generic. It always starts at 1 and decays towards 0. But what if we want to start at a different value? Or maybe we want it to decay towards a different value than 0?</p>
<p>No problem! We can easily customize this function.</p>
<p>First, let’s give it a starting point. We can add a multiplicative factor (let’s call it <span class="math inline">\(b\)</span>) to the exponential function. This is like giving our function a “starting height.” Now, our function looks like this: <span class="math inline">\(b \cdot e^{-x \cdot \lambda}\)</span></p>
<p>Next, let’s give it a target value. We can add a linear factor (let’s call it <span class="math inline">\(a\)</span>) to shift the entire curve up or down. This is like setting a new “ground level” for our function.</p>
<div class="page-columns page-full"><p><img src="exponential-function-cartoon.jpeg" class="img-fluid" style="width:100.0%"> </p><div class="no-row-height column-margin column-container"><span class="margin-aside">In fact, she did use it at the end. Photo from Frank Mariani in <a href="https://www.cartoonistforhire.com/frank-mariani-book-illustration/">Cartoonist for Hire</a></span></div></div>
<p>With these adjustments, our function now looks like this:</p>
<p><span class="math display">\[
a + b \cdot e^{-x \cdot \lambda}
\]</span></p>
<p>This gives us much more flexibility! For example, if we set <span class="math inline">\(a\)</span> to 0 and <span class="math inline">\(b\)</span> to 1, we get our original function. It’s like having a basic template and then customizing it to fit our specific needs.</p>
<p>But wait a minute! We’ve been doing all this math, and we haven’t even talked about neurons yet! What was the point of all this mental gymnastics? Well, it turns out that this seemingly random function has a very real biological meaning.</p>
<p>Let’s take a look at that equation again, but this time with some real neuron terms:</p>
<p><span class="math display">\[
V(t) = E_L + (V_0 - E_L) \cdot e^{-g_L \cdot t}
\]</span></p>
<p>Now, this equation starts to make sense. It tells us how the membrane potential (<span class="math inline">\(V\)</span>) changes over time (<span class="math inline">\(t\)</span>). It’s like watching a movie of the membrane potential.</p>
<ul>
<li><span class="math inline">\(V(t)\)</span>: This is the membrane potential at any given moment – the voltage across the cell membrane at that exact instant.</li>
<li><span class="math inline">\(E_L\)</span>: This is the “leak reversal potential,” the magical voltage where the leak channels are perfectly balanced. It’s like the “sweet spot” for the membrane, usually close to the resting membrane potential (around -70 mV).</li>
<li><span class="math inline">\(V_0\)</span>: This is the starting point, the initial membrane potential at time <span class="math inline">\(t = 0\)</span>. It’s like the starting position in a race.</li>
<li><span class="math inline">\(g_L\)</span>: This is the “leak conductance,” a measure of how easily ions can leak through the membrane. Think of it as how wide the leaky faucet is open. A higher <span class="math inline">\(g_L\)</span> means ions leak faster, and the membrane potential changes more quickly.</li>
<li><span class="math inline">\(e^{-g_L \cdot t}\)</span>: This is the exponential decay term, the engine that drives the change. It ensures that the membrane potential gradually approaches <span class="math inline">\(E_L\)</span> over time, like a car slowly coming to a stop.</li>
</ul>
<div class="page-columns page-full"><p><img src="confused-math.gif" class="img-fluid" style="width:100.0%"> </p><div class="no-row-height column-margin column-container"><span class="margin-aside"><strong>Average Bayesically-Speaking reader</strong> going through the content I write in a typical blog post after I say “We’ll start with the basics”. Photo from <a href="https://giphy.com/gifs/producthunt-zach-galifianakis-algorithm-3o6Yg4GUVgIUg3bf7W">Giphy</a></span></div></div>
<p>Now, let’s get a little more mathematical. If we want to express how the membrane potential changes over time, we need to find the “rate of change” of the membrane potential. In math terms, this is called the derivative.</p>
<p>If we take the derivative of our previous equation (don’t worry, you don’t need to know the calculus!), we get something like this:</p>
<p><span class="math display">\[
\frac{d V}{d t} = -g_L \cdot (V_0 - E_L)
\]</span></p>
<p>This equation tells us how fast the membrane potential is changing at any given moment.</p>
<p>Let’s break this down:</p>
<ul>
<li><span class="math inline">\(\frac{d V}{d t}\)</span>: This fancy term represents the “rate of change” of the membrane potential. It tells us how quickly the voltage is rising or falling.</li>
<li><span class="math inline">\(g_L\)</span>: This is our old friend, the leak conductance. A higher <span class="math inline">\(g_L\)</span> means the membrane is “leaky,” and the membrane potential will change more rapidly.</li>
<li><span class="math inline">\((V_0 - E_L)\)</span>: This term represents the “driving force” for the leak current. The bigger the difference between the current potential and the leak reversal potential, the stronger the “urge” for the membrane potential to return to equilibrium. It’s like a ball rolling down a steep hill, the steeper the hill, the faster it rolls.</li>
</ul>
<p>If we were to plot the solution to this equation (and we will), we would see an exponential decay curve. It’s like watching a ball rolling down a hill, it starts fast but gradually slows down as it approaches the bottom.</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="fl">0.1</span>) <span class="co"># Time vector</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate membrane potential over time</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>membrane_potential <span class="ot">&lt;-</span> <span class="cf">function</span>(time, V0, g_L, E_L) {</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  V <span class="ot">&lt;-</span> (V0 <span class="sc">-</span> E_L) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>g_L <span class="sc">*</span> time) <span class="sc">+</span> E_L</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(V)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Starting membrane potentials</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">50</span>,<span class="sc">-</span><span class="dv">60</span>,<span class="sc">-</span><span class="dv">65</span>,<span class="sc">-</span><span class="dv">68</span>,<span class="sc">-</span><span class="dv">72</span>,<span class="sc">-</span><span class="dv">75</span>,<span class="sc">-</span><span class="dv">80</span>,<span class="sc">-</span><span class="dv">90</span>), <span class="cf">function</span>(x) {</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>           <span class="fu">data.table</span>(<span class="at">v =</span> <span class="fu">membrane_potential</span>(time, <span class="at">V0 =</span> x, <span class="at">g_L =</span> <span class="fl">0.1</span>, <span class="at">E_L =</span> <span class="sc">-</span><span class="dv">70</span>),</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">start_v =</span> x,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">time =</span> time)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>         }) <span class="sc">|&gt;</span> </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbindlist</span>()</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot using ggplot2</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> v, <span class="at">color =</span> <span class="fu">ordered</span>(start_v))) <span class="sc">+</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="dv">70</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span> <span class="co"># Add E_L line</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time (Arbitrary Units)"</span>,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Membrane Potential (mV)"</span>,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Membrane Potential Decay Due to Leak Current"</span>,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Starting Voltage (mV)"</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.svg" class="img-fluid figure-img"></p>
<figcaption class="margin-caption"><strong>Membrane Potential and Leak Current</strong>. Here we can see that the membrane tends to return to its resting potential. This behavior is accomplished by the tweaks we made earlier to our exponential function.</figcaption>
</figure>
</div>
</div>
</div>
<p>For example, if we inject a small current that briefly changes the membrane potential to -60mV, the membrane potential will decay back to -70mV, following the equation.</p>
</section>
<section id="too-simple" class="level4">
<h4 class="anchored" data-anchor-id="too-simple">Too Simple?</h4>
<p>This simple model is important because it shows us how the membrane potential would behave <em>passively</em>, in the absence of any active processes. It explains how the resting membrane potential is maintained. However, it <em>doesn’t</em> explain the rapid, dramatic changes we see during an action potential. Our sleepy neuron is still just leaking and slowly returning to its resting state. It’s like watching paint dry (not exactly thrilling). We need something more to explain the neuron’s “shouting” behavior. That “something more” is the introduction of voltage-gated ion channels, which we’ll explore in the next section.</p>
<p>Okay, let’s add some simplified equations to represent the voltage-gated channels and incorporate them into our membrane potential equation.</p>
</section>
</section>
<section id="adding-voltage-gated-channels-the-key-to-excitation" class="level1 page-columns page-full">
<h1>Adding Voltage-Gated Channels: The Key to Excitation</h1>
<div class="page-columns page-full"><p><img src="recording-animation.gif" class="img-fluid" style="width:100.0%"> </p><div class="no-row-height column-margin column-container"><span class="margin-aside">Photo from <a href="https://www.humanbiomedia.org/action-potential-media/">Human Bio Media</a></span></div></div>
<p>Okay, let’s get down to the nitty-gritty. How does this whole “voltage” thing actually work? Well, picture this: the change in voltage over time (basically how fast the voltage is shifting), is all about the flow of ions. You’ve got ions lazily leaking through the membrane (let’s call that the “lazy ion flow”), and then you’ve got the more exciting players: sodium, potassium, and even some other ions that like to join the party.</p>
<p>So, if we want to get fancy, we could say that the change in voltage over time, which we can write as <span class="math inline">\(\frac{dV}{dt}\)</span> for all you math whizzes out there, is basically a sum of all these ion flows. We’ve got the lazy ion flow (<span class="math inline">\(I_L\)</span>), the sodium party crashers (<span class="math inline">\(I_{Na}\)</span>), the potassium crew (<span class="math inline">\(I_K\)</span>), and any other surprise guests (<span class="math inline">\(I_n\)</span>).</p>
<p>And if we want to put it all together in a fancy equation, we could say that:</p>
<p><span class="math display">\[
\frac{dV}{dt} = I_L + I_{Na} + I_K + \dots + I_{n}
\]</span></p>
<p>So, now we’ve got this “leaky current” (<span class="math inline">\(I_L\)</span>), which we can basically describe using that fancy equation <span class="math inline">\(-g_L \cdot (V_0 - E_L)\)</span>. But what about those exciting voltage-gated channels? How do we explain their contribution to the party? To figure that out, we need to dive deeper into the wild world of channel dynamics.</p>
<p>Remember our boring old passive membrane? It just kind of slumped back to its resting potential, like a deflated balloon. Well, our active neurons are a whole different story. They’ve got these amazing channels that open and close depending on the voltage, making the whole system much more exciting.</p>
<p>These channels, especially the sodium (<span class="math inline">\(Na^+\)</span>) and potassium (<span class="math inline">\(K^+\)</span>) channels, are the real stars of the show. They’re the ones that cause those dramatic swings in voltage during an action potential.</p>
<div class="page-columns page-full"><p><img src="sodium-channel-open-state.png" class="img-fluid" style="width:100.0%"> </p><div class="no-row-height column-margin column-container"><span class="margin-aside">Sodium channel in an open state, illustrating its activation and inactivation gates. Photo from <a href="https://www.humanbiomedia.org/action-potential-media/">Human Bio Media</a></span></div></div>
<p>Sodium channels are like little gates. They have an “activation gate” (let’s call it gate <span class="math inline">\(m\)</span>) that swings open around -55mV. This is like the starting pistol for the race! Sodium ions flood into the cell, and the voltage skyrockets. But here’s the catch: these channels also have an “inactivation gate” (let’s call it gate <span class="math inline">\(h\)</span>) that slams shut around +30mV. It’s like the emergency brakes! This prevents the cell from exploding with too much sodium. And don’t worry, the inactivation gate eventually reopens when the cell calms down and returns to its resting potential (around -70mV).</p>
<p>So, if we want to express the sodium current (<span class="math inline">\(I_{Na}\)</span>) in all its glory, we could say that:</p>
<p><span class="math display">\[
I_{Na} = -g_{Na} \cdot m \cdot h \cdot (V_0 - E_{Na})
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(g_{Na}\)</span>: Sodium conductance (how easily sodium ions flow when channels are open).</li>
<li><span class="math inline">\(m\)</span>: Sodium activation gate (1 = open, 0 = closed).</li>
<li><span class="math inline">\(h\)</span>: Sodium inactivation gate (1 = open, 0 = closed). This gate introduces a delay and helps terminate the sodium current.</li>
<li><span class="math inline">\(E_{Na}\)</span>: Sodium reversal potential.</li>
</ul>
<p>In contrast, potassium channels are a bit simpler. They only have one gate (let’s call it gate <span class="math inline">\(n\)</span>), which acts like a slow-opening door. This gate starts to swing open around +30mV, allowing potassium ions to flood out of the cell. This outflow of positive charge helps bring the voltage back down to resting potential (a phase we call “repolarization”). But here’s the twist: this gate is a bit slow to close. It doesn’t fully shut until the voltage dips below -80mV, which is even more negative than the resting potential. This creates a slight undershoot before the cell finally settles back down.</p>
<div class="page-columns page-full"><p><img src="potassium-channel-open-state.png" class="img-fluid" style="width:100.0%"> </p><div class="no-row-height column-margin column-container"><span class="margin-aside">Potassium channel in an open state, with its only voltage-dependent gate. Photo from <a href="https://www.humanbiomedia.org/action-potential-media/">Human Bio Media</a></span></div></div>
<p>Just like we did with the sodium channels, we can express the potassium current (<span class="math inline">\(I_K\)</span>) as the following:</p>
<p><span class="math display">\[
I_{K} = -g_{K} \cdot n \cdot (V_0 - E_{K})
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(g_K\)</span>: Potassium conductance.</li>
<li><span class="math inline">\(n\)</span>: Potassium activation gate (1 = open, 0 = closed).</li>
<li><span class="math inline">\(E_K\)</span>: Potassium reversal potential.</li>
</ul>
<p>So now, our updated equation now looks like this:</p>
<div class="page-columns page-full"><p><span class="math display">\[
\begin{aligned}
\frac{dV}{dt} = -&amp;g_L \cdot (V - E_L) + \\
-&amp;g_{Na} \cdot m \cdot h \cdot (V - E_{Na}) + \\
-&amp;g_K \cdot n \cdot (V - E_K)
\end{aligned}
\]</span> </p><div class="no-row-height column-margin column-container"><span class="margin-aside">To maintain clarity and focus on the core dynamics, we’ll use simplified “on/off” gating variables rather than the full Hodgkin-Huxley equations (which we can explore another time).</span></div></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Simplified Gating: A Key Simplification
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>In the real world, these gating variables (<code>m</code>, <code>h</code>, and <code>n</code>) are described by some seriously complex equations in the full Hodgkin-Huxley model. It’s like trying to understand the inner workings of a Swiss watch!</p>
<p>But for our simplified model, we’re going to take a shortcut. We’ll assume these gates simply snap open and shut based on the voltage. It’s like we’re replacing that intricate Swiss watch with a simple on/off switch. This simplification helps us grasp the fundamental principles of action potential generation without getting bogged down in a sea of equations.</p>
</div>
</div>
</div>
<p>With these additions, our model finally starts to show some exciting behavior! If the membrane potential reaches a certain “trigger point” (called the threshold), the sodium channels swing open wide (m = 1). It’s like a floodgate opening! Sodium ions rush into the cell, causing a rapid spike in voltage, that’s our action potential!</p>
<p>But then, the sodium inactivation gate slams shut (h = 0), and the potassium channels finally open their doors (n = 1). Potassium ions rush out of the cell, bringing the voltage back down to normal, that’s the “repolarization” phase.</p>
<div class="page-columns page-full"><p><img src="ion-channels.png" class="img-fluid" style="width:100.0%"> </p><div class="no-row-height column-margin column-container"><span class="margin-aside">Voltage-gated channels for sodium (Na<sup>+</sup>) and potassium (K<sup>+</sup>). ECF, extracellular fluid; ICF, intracellular fluid. Photo from <a href="https://www.humanbiomedia.org/action-potential-media/">Human Bio Media</a></span></div></div>
<p>Now, let’s put this model into action! We’ll use something called the Euler method, which is basically a fancy way of numerically solving our equation. This will allow us to see how the membrane potential changes over time in response to a stimulus. It’s like running a simulation to see how our “neuron” behaves in the real world.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
About the Hodgkin-Huxley Model
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>The Hodgkin-Huxley equations, developed in the mid-20th century, revolutionized our understanding of how neurons fire. These complex equations, initially derived from meticulous experiments on the giant squid axon, accurately model the intricate interplay of ion channels that generate the action potential.</p>
<p>Okay but, why it matters today? Well, for many reasons like:</p>
<ul>
<li><strong>Foundation for modern neuroscience:</strong> The Hodgkin-Huxley model remains a cornerstone of computational neuroscience, providing a framework for understanding the electrical behavior of neurons.</li>
<li><strong>Drug development:</strong> Researchers use these equations to study the effects of drugs and toxins on neuronal activity, aiding in the development of new medications for neurological disorders.</li>
<li><strong>Artificial intelligence:</strong> Inspired by the Hodgkin-Huxley model, researchers are developing biologically realistic artificial neurons for use in neuromorphic computing, a promising area of artificial intelligence.</li>
</ul>
</div>
</div>
</div>
<!-- IV. Simulating an Action Potential: Playing with Parameters -->
</section>
<section id="simulating-an-action-potential-bringing-the-model-to-life" class="level1 page-columns page-full">
<h1>Simulating an Action Potential: Bringing the Model to Life</h1>
<p>Alright, let’s get this show on the road! Now that we have our simplified mathematical model of the neuron, it’s time to bring it to life. We’ll use R, a powerful programming language, to simulate our model and watch how the membrane potential changes over time.</p>
<p>We’ll use a technique called the Euler method, which is basically like taking tiny little steps to solve our equation. It’s a bit like trying to reach a destination by taking a series of small hops instead of jumping straight there.</p>
<div class="page-columns page-full"><p><img src="wojak-meme.png" class="img-fluid" style="width:100.0%"> </p><div class="no-row-height column-margin column-container"><span class="margin-aside">Average Bayesically-Speaking reader when is asked about their knowledge on voltage-gated channels. Photo from <a href="https://wojak-studio.com">Wojak-Studio</a></span></div></div>
<section id="setting-the-stage-defining-the-parameters" class="level4">
<h4 class="anchored" data-anchor-id="setting-the-stage-defining-the-parameters">Setting the Stage: Defining the Parameters</h4>
<p>First, we need to define the parameters of our model. These parameters represent the properties of our neuron, such as how “leaky” the membrane is and the properties of the sodium and potassium channels. We also need to define the time step (<code>dt</code>), which determines how often we “take a picture” of the membrane potential during our simulation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">g_L =</span> <span class="dv">1</span>, <span class="at">E_L =</span> <span class="sc">-</span><span class="dv">70</span>,   <span class="do">## Leak Channels</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">g_Na =</span> <span class="dv">20</span>, <span class="at">E_Na =</span> <span class="dv">30</span>, <span class="do">## Sodium Channels</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">g_K =</span> <span class="dv">2</span>, <span class="at">E_K =</span> <span class="sc">-</span><span class="dv">90</span>,   <span class="do">## Potassium Channels</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">dt =</span> <span class="fl">0.001</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here:</p>
<ul>
<li><code>g_L</code>: Leak conductance.</li>
<li><code>E_L</code>: Leak reversal potential (resting potential).</li>
<li><code>g_Na</code>: Sodium conductance.</li>
<li><code>E_Na</code>: Sodium reversal potential.</li>
<li><code>g_K</code>: Potassium conductance.</li>
<li><code>E_K</code>: Potassium reversal potential.</li>
<li><code>dt</code>: Time step (0.001 ms).</li>
</ul>
</section>
<section id="the-sodium-activation-gate-the-onoff-switch" class="level4">
<h4 class="anchored" data-anchor-id="the-sodium-activation-gate-the-onoff-switch">The Sodium Activation Gate: The On/Off Switch</h4>
<p>The sodium activation gate (<code>m</code>) is like the “on” switch for sodium channels. When the membrane potential (<code>V_prev</code>) reaches a critical point, around -55mV, this gate swings open instantly, allowing sodium ions to flood in. It’s like someone yelling “Go!” at a starting line.</p>
<p>In our simplified model, we’re making a big assumption: this gate is an all-or-nothing switch. Either it’s completely open (<code>m</code> becomes 1) or completely closed (<code>m</code> is 0). This is a simplification, but it helps us capture the essence of the rapid rise of the action potential.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>update_m <span class="ot">&lt;-</span> <span class="cf">function</span>(V_prev) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(V_prev <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">55</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function takes the previous membrane potential (<code>V_prev</code>) as input and tells us whether the sodium activation gate is open or closed.</p>
</section>
<section id="the-sodium-inactivation-gate-the-emergency-brake" class="level4">
<h4 class="anchored" data-anchor-id="the-sodium-inactivation-gate-the-emergency-brake">The Sodium Inactivation Gate: The Emergency Brake</h4>
<p>The sodium inactivation gate (<code>h</code>) is like the emergency brake for the sodium channels. It starts open (<code>h</code> = 1) at rest, but when the membrane depolarizes and sodium channels open wide (<code>m</code> = 1), this gate slowly starts to close (<code>h</code> transitions towards 0). This is crucial to prevent a runaway influx of sodium.</p>
<p>However, the inactivation gate only starts to close when the membrane potential is sufficiently positive (around +20mV). It’s like the brake only engages when the car is going fast enough.</p>
<p>Conversely, when the membrane repolarizes and the sodium channels close (<code>m</code> = 0), the inactivation gate slowly reopens (<code>h</code> transitions towards 1). But this recovery only happens when the membrane potential is sufficiently negative (around -70mV). It’s like the brake only releases when the car has slowed down significantly.</p>
<p>This conditional behavior is implemented in the following function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>update_h <span class="ot">&lt;-</span> <span class="cf">function</span>(m_current, V_prev, h_prev) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">test =</span> m_current <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> V_prev <span class="sc">&gt;=</span> <span class="dv">20</span>, </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">yes =</span> <span class="dv">0</span>, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">no =</span> <span class="fu">ifelse</span>(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">test =</span> m_current <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> V_prev <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">70</span>, </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">yes =</span> <span class="dv">1</span>, </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">no =</span> h_prev</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function takes the current value of <code>m</code> (<code>m_current</code>), the previous membrane potential (<code>V_prev</code>), and the previous value of <code>h</code> (<code>h_prev</code>) as inputs and returns the updated value of <code>h</code>.</p>
</section>
<section id="the-potassium-activation-gate-the-slow-and-steady-door" class="level4">
<h4 class="anchored" data-anchor-id="the-potassium-activation-gate-the-slow-and-steady-door">The Potassium Activation Gate: The Slow and Steady Door</h4>
<p>The potassium activation gate (<code>n</code>) is like a slow-opening door. It starts to open when the membrane potential reaches a sufficiently positive value (around +20mV). But unlike the sodium gate, it’s a bit sluggish.</p>
<p>There’s also a bit of “hysteresis” here. This means that the potassium gate only closes when the membrane potential becomes extremely negative (around -80mV) <em>and</em> it was already open in the previous time step. It’s like the door is reluctant to close once it’s been opened. This hysteresis ensures that the membrane repolarizes completely before the potassium channels fully close.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>update_n <span class="ot">&lt;-</span> <span class="cf">function</span>(V_prev, n_prev) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">test =</span> V_prev <span class="sc">&gt;=</span> <span class="dv">20</span>, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">yes =</span> <span class="dv">1</span>, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">no =</span> <span class="fu">ifelse</span>(</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">test =</span> V_prev <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">80</span> <span class="sc">&amp;</span> n_prev <span class="sc">==</span> <span class="dv">1</span>, </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">yes =</span> <span class="dv">0</span>, </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">no =</span> n_prev</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function takes the previous membrane potential (<code>V_prev</code>) and the previous value of <code>n</code> (<code>n_prev</code>) as input and returns the updated value of <code>n</code>.</p>
</section>
<section id="calculating-the-ion-flows-the-grand-finale" class="level4">
<h4 class="anchored" data-anchor-id="calculating-the-ion-flows-the-grand-finale">Calculating the Ion Flows: The Grand Finale</h4>
<p>This function calculates the flow of ions across the membrane. We have three main players:</p>
<ul>
<li><strong>The Leaky Current:</strong> This is the “background” current, where ions slowly leak through the membrane.</li>
<li><strong>The Sodium Current:</strong> This is where the action happens! It’s influenced by the sodium activation gate (<code>m</code>) and the inactivation gate (<code>h</code>).</li>
<li><strong>The Potassium Current:</strong> This current is controlled by the potassium activation gate (<code>n</code>).</li>
</ul>
<p>To calculate each current, we use a simple formula: <span class="math inline">\(I = g \cdot (V - E)\)</span>. It’s like calculating the flow of water through a pipe, where <span class="math inline">\(g\)</span> represents the size of the pipe, <span class="math inline">\(V\)</span> is the pressure difference, and <span class="math inline">\(E\)</span> is a kind of “equilibrium point.”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>calculate_currents <span class="ot">&lt;-</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(V_prev, m, h, n, params) {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  l_current <span class="ot">&lt;-</span> <span class="sc">-</span>params<span class="sc">$</span>g_L <span class="sc">*</span> (V_prev <span class="sc">-</span> params<span class="sc">$</span>E_L)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  na_current <span class="ot">&lt;-</span> <span class="sc">-</span>params<span class="sc">$</span>g_Na <span class="sc">*</span> m <span class="sc">*</span> h <span class="sc">*</span> (V_prev <span class="sc">-</span> params<span class="sc">$</span>E_Na)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  k_current <span class="ot">&lt;-</span> <span class="sc">-</span>params<span class="sc">$</span>g_K <span class="sc">*</span> n <span class="sc">*</span> (V_prev <span class="sc">-</span> params<span class="sc">$</span>E_K)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">l_current =</span> l_current, </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na_current =</span> na_current, </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">k_current =</span> k_current)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function takes the previous membrane potential (<code>V_prev</code>), the gating variables (<code>m</code>, <code>h</code>, <code>n</code>), and the parameters (<code>params</code>) as input and returns a list containing the calculated currents.</p>
</section>
<section id="simulating-neurons-in-action-bringing-it-all-together" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="simulating-neurons-in-action-bringing-it-all-together">Simulating Neurons in Action: Bringing it All Together!</h4>
<p>This is the grand finale! This function brings all the pieces together to simulate how our neuron actually behaves. It takes the model parameters, a time vector (which tells us how long to run the simulation), and a stimulus current (like an external input to the neuron) as input.</p>
<p>Then, it iterates through each time step, updating the gating variables (those pesky “m,” “h,” and “n” gates) and calculating how the membrane potential changes using the Euler method. It’s like watching a movie frame-by-frame, seeing how the neuron responds to the different inputs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>simulate_ap <span class="ot">&lt;-</span> <span class="cf">function</span>(params, time, stimulus_current) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(time)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  V <span class="ot">&lt;-</span> <span class="fu">rep</span>(params<span class="sc">$</span>E_L, n) <span class="co"># Initialize Membrane potential</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n) <span class="co"># Initialize Sodium Activation</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, n) <span class="co"># Initialize Sodium Inactivation</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  n_inf <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n) <span class="co"># Initialize Potassium Activation</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  l_current <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n) <span class="co"># Initialize Leak Current</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  na_current <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n) <span class="co"># Initialize Sodium Current</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  k_current <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n) <span class="co"># Initialize Potassium Current</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Updates the state of each channel's gates</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    m[i] <span class="ot">&lt;-</span> <span class="fu">update_m</span>(V[i <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    h[i] <span class="ot">&lt;-</span> <span class="fu">update_h</span>(m[i], V[i <span class="sc">-</span> <span class="dv">1</span>], h[i <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    n_inf[i] <span class="ot">&lt;-</span> <span class="fu">update_n</span>(V[i <span class="sc">-</span> <span class="dv">1</span>], n_inf[i <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Compute the current </span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    currents <span class="ot">&lt;-</span> <span class="fu">calculate_currents</span>(</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">V_prev =</span> V[i <span class="sc">-</span> <span class="dv">1</span>], </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">m =</span> m[i], </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">h =</span> h[i], </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">n =</span> n_inf[i], </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">params =</span> params</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    l_current[i] <span class="ot">&lt;-</span> currents<span class="sc">$</span>l_current</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    na_current[i] <span class="ot">&lt;-</span> currents<span class="sc">$</span>na_current</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    k_current[i] <span class="ot">&lt;-</span> currents<span class="sc">$</span>k_current</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Sum each current contribution to the overall voltage change</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    dVdt <span class="ot">&lt;-</span> </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>      l_current[i] <span class="sc">+</span> </span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>      na_current[i] <span class="sc">+</span> </span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>      k_current[i] <span class="sc">+</span> </span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>      stimulus_current[i]</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Update the Voltage based on current net flow</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    V[i] <span class="ot">&lt;-</span> </span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>      V[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> dVdt <span class="sc">*</span> params<span class="sc">$</span>dt</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">Time =</span> time, <span class="at">Voltage =</span> V)</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function gets the party started! It initializes the membrane potential and all those gating variables (“m,” “h,” and “n”) to their starting values. Then, it enters a loop, stepping through time and updating these variables at each step. It’s like watching a movie play out frame-by-frame, observing how the membrane potential changes in response to the shifting currents.</p>
<p>Now, let’s run this simulation and see what happens! We’ll visualize the results to get a better understanding of how the neuron behaves.</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulation time</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">8</span>, <span class="at">by =</span> params<span class="sc">$</span>dt)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Stimulus</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>stimulus_current <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(time))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>stimulus_current[time <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">&amp;</span> time <span class="sc">&lt;</span> <span class="fl">2.5</span>] <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the simulation</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">simulate_ap</span>(params, time, stimulus_current)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(Time, Voltage)) <span class="sc">+</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="dv">70</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time (ms)"</span>, <span class="at">y =</span> <span class="st">"Membrane Potential (mV)"</span>, <span class="at">title =</span> <span class="st">"Simplified Action Potential Model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="index_files/figure-html/unnamed-chunk-11-1.svg" class="img-fluid figure-img"></p>
<figcaption class="margin-caption"><strong>Simplified Action Potential Model</strong>. Here we can see that after taking into account each contribution to the overall voltage dynamics over time (based on net current flow), we can see something more alike to a real action potential curve.</figcaption>
</figure>
</div>
</div>
</div>
<!-- Systematically vary key parameters, such as: -->
</section>
</section>
<section id="tweaking-the-knobs-sensitivity-analysis" class="level1 page-columns page-full">
<h1>Tweaking the Knobs: Sensitivity Analysis</h1>
<p>Now that we have our neuron simulation up and running, let’s see what happens when we start tinkering with the settings. This is called <em>sensitivity analysis</em>. We’ll systematically change one parameter at a time and see how it affects the neuron’s behavior. It’s like tweaking the knobs on a radio to see how it changes the sound.</p>
<p>This analysis is crucial for understanding how our model works and figuring out which parameters have the biggest impact on the action potential. It’s like trying to figure out which ingredients are most important for baking the perfect cake.</p>
<p>To make this process easier, we’ll create a special function called <code>sensitivity_analysis</code>. This function takes the model parameters, the time vector, the stimulus current, the name of the parameter we want to change (<code>param_name</code>), and a list of values we want to test for that parameter (<code>values</code>) as input. It then runs the simulation for each value in the list, stores the results, and combines them all into a single, organized data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sensitivity_analysis <span class="ot">&lt;-</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(params, time, stimulus_current, param_name, values) {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (value <span class="cf">in</span> values) {</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Modify the parameter value</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>      modified_params <span class="ot">&lt;-</span> params</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>      modified_params[[param_name]] <span class="ot">&lt;-</span> value </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Run the simulation</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">&lt;-</span> <span class="fu">simulate_ap</span>(modified_params, time, stimulus_current) </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add a column to track the parameter value</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>      df<span class="sc">$</span>ParameterValue <span class="ot">&lt;-</span> value</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Store the results</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>      results[[<span class="fu">as.character</span>(value)]] <span class="ot">&lt;-</span> df</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    output <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(results)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(output) <span class="co"># Combine all data.tables into one</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Inside the function, we do the following:</p>
<ol type="1">
<li><strong>Create an empty list:</strong> We create an empty list called <code>results</code> to store the output of each simulation. Think of it as an empty box to store all our simulation results.</li>
<li><strong>Loop through the values:</strong> We loop through each value in the list of values we want to test. It’s like trying different settings on a machine one by one.</li>
<li><strong>Make a copy:</strong> We create a copy of our original parameters called <code>modified_params</code>. This is crucial to avoid messing up the original settings.</li>
<li><strong>Tweak the parameter:</strong> We modify the specific parameter (<code>param_name</code>) in our <code>modified_params</code> copy to the current value from our list.</li>
<li><strong>Run the simulation:</strong> We run our <code>simulate_ap</code> function with these modified parameters to see how the neuron behaves.</li>
<li><strong>Add a label:</strong> We add a new column called <code>ParameterValue</code> to the results to keep track of which parameter value we used for that simulation. It’s like labeling each experiment.</li>
<li><strong>Store the results:</strong> We store the results of this simulation in our <code>results</code> list, using the parameter value as a label for easy reference.</li>
<li><strong>Combine the results:</strong> Finally, we use a special function called <code>rbindlist</code> to neatly combine all the individual data frames in our <code>results</code> list into one big data frame. This gives us a complete overview of how the neuron behaves with different parameter settings.</li>
</ol>
<section id="the-plotting-function-seeing-the-results" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="the-plotting-function-seeing-the-results">The Plotting Function: Seeing the Results</h4>
<p>Now, let’s visualize our results! We’ll create a special function called <code>plot_sensitivity</code> to do this. This function takes the combined results data frame and the name of the parameter we were analyzing as input. It then generates a plot that shows how the membrane potential changes over time for each of the parameter values we tested. It’s like creating a visual story of how the neuron behaves under different conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>plot_sensitivity <span class="ot">&lt;-</span> <span class="cf">function</span>(results, param_name) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(results, <span class="fu">aes</span>(Time, Voltage, <span class="at">color =</span> <span class="fu">factor</span>(ParameterValue))) <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="dv">70</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time (ms)"</span>, <span class="at">y =</span> <span class="st">"Membrane Potential (mV)"</span>, </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> scales<span class="sc">::</span><span class="fu">label_parse</span>()(<span class="fu">paste</span>(<span class="st">"Sensitivity~Analysis~of~"</span>, param_name))) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_ordinal</span>(<span class="at">name =</span> scales<span class="sc">::</span><span class="fu">label_parse</span>()(param_name))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function creates a line plot using <code>ggplot2</code>, where the x-axis represents time, the y-axis represents the membrane potential, and different colors represent different values of the varied parameter. The <code>factor()</code> function is used to treat the <code>ParameterValue</code> as a categorical variable, ensuring that each value gets a distinct color in the plot.</p>
<div class="page-columns page-full"><p><img src="math-confused-girl.jpeg" class="img-fluid" style="width:100.0%"> </p><div class="no-row-height column-margin column-container"><span class="margin-aside">Your face after I told you that we’re going to see the basics and it turned out not so basic after all. Photo from <a href="https://cl.pinterest.com/pin/800022321283732215/">Pinteres</a></span></div></div>
</section>
<section id="setting-the-stage-for-simulations" class="level4">
<h4 class="anchored" data-anchor-id="setting-the-stage-for-simulations">Setting the Stage for Simulations</h4>
<p>Before we dive into the nitty-gritty of sensitivity analysis, we need to set the stage for our simulations.</p>
<ul>
<li><strong>Time:</strong> We define the simulation time, which tells us how long to run the experiment. We’ll run the simulation from 0 to 8 milliseconds (ms).</li>
<li><strong>Time Step:</strong> We need to decide how often we “take a picture” of the membrane potential. This is determined by the <code>dt</code> parameter in our <code>params</code> list.</li>
<li><strong>Stimulus:</strong> We’ll create a brief stimulus current, like a little jolt of electricity, that’s applied between 0.5 and 1.0 milliseconds.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulation time and stimulus</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="at">by =</span> params<span class="sc">$</span>dt)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>stimulus_current <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="fu">length</span>(time))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>stimulus_current[time <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> time <span class="sc">&lt;</span> <span class="fl">1.0</span>] <span class="ot">&lt;-</span> <span class="dv">50</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="assessing-the-effect-of-sodium-conductance-g_na-turning-up-the-heat" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="assessing-the-effect-of-sodium-conductance-g_na-turning-up-the-heat">Assessing the Effect of Sodium Conductance (<span class="math inline">\(g_{Na}\)</span>): Turning Up the Heat</h4>
<p>Now, let’s see what happens when we tweak the sodium conductance (<span class="math inline">\(g_{Na}\)</span>). This is like adjusting the heat on a stove.</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run sensitivity analysis for g_Na</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>gna_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">9.5</span>, <span class="dv">10</span>, <span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">20</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>gna_results <span class="ot">&lt;-</span> <span class="fu">sensitivity_analysis</span>(params, time, stimulus_current, <span class="st">"g_Na"</span>, gna_values)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_sensitivity</span>(gna_results, <span class="st">"g[Na]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="index_files/figure-html/unnamed-chunk-15-1.svg" class="img-fluid figure-img"></p>
<figcaption class="margin-caption"><strong>Effect of g<sub>Na</sub> in Potential Dynamics</strong>. Here we can see the overall effect of changing the sodium conductance on membrane potential dynamics.</figcaption>
</figure>
</div>
</div>
</div>
<p>By running our <code>sensitivity_analysis</code> function and then plotting the results, we can clearly see how changing <span class="math inline">\(g_{Na}\)</span> affects the action potential. It’s like watching how turning up the heat affects how quickly water boils. As expected, increasing <span class="math inline">\(g_{Na}\)</span> makes the depolarization much faster and more dramatic.</p>
</section>
<section id="assessing-the-effect-of-potassium-conductance-g_k-controlling-the-cool-down" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="assessing-the-effect-of-potassium-conductance-g_k-controlling-the-cool-down">Assessing the Effect of Potassium Conductance (<span class="math inline">\(g_{K}\)</span>): Controlling the Cool-Down</h4>
<p>Next, let’s see how changing the potassium conductance (<span class="math inline">\(g_{K}\)</span>) affects things. This is like adjusting the thermostat, it controls the cool-down period.</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run sensitivity analysis for g_K</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>gk_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>gk_results <span class="ot">&lt;-</span> <span class="fu">sensitivity_analysis</span>(params, time, stimulus_current, <span class="st">"g_K"</span>, gk_values)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_sensitivity</span>(gk_results, <span class="st">"g[K]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.svg" class="img-fluid figure-img"></p>
<figcaption class="margin-caption"><strong>Effect of g<sub>K</sub> in Potential Dynamics</strong>. Here we can see the overall effect of changing the potassium conductance on membrane potential dynamics.</figcaption>
</figure>
</div>
</div>
</div>
<p>Again, using our handy functions, we can easily see how <span class="math inline">\(g_{K}\)</span> impacts the action potential. Increasing <span class="math inline">\(g_{K}\)</span> makes the repolarization phase much faster and more pronounced. It’s like adding more ice to a hot drink, it cools down much quicker. This structured approach allows us to efficiently explore how different parameters affect our model and gain a deeper understanding of its dynamics.</p>
</section>
</section>
<section id="so-you-think-you-know-how-a-neuron-fires-think-again" class="level1 page-columns page-full">
<h1>So, You Think You Know How a Neuron Fires? Think Again!</h1>
<p>Okay, let’s be honest, this “action potential” business is a bit overhyped. It’s basically just a fancy term for a sudden influx of sodium ions followed by a swift efflux of potassium. <em>Really</em>, who needs all those fancy textbooks and intimidating equations?</p>
<p>Our little model here? Yeah, it’s basically a “neuron for beginners.” We stripped it down to the essentials, ignoring the nitty-gritty details like how ion channels actually open and close and the subtle ways different potassium channels interact. Who needs that level of detail, right?</p>
<p>Now, let’s get real for a second. Real neurons? They’re not this simple. Oh no. They have a whole zoo of ion channels, each with its own quirks and preferences for voltage. Sodium channels? Potassium channels? Please, it’s more like a neurochemical orchestra! And don’t even get me started on the calcium-dependent potassium channels…</p>
<p>But hey, our little “dumbed-down” neuron serves a purpose. It’s like, the “Cliff’s Notes” of neurophysiology. You get the main idea, you understand the basic principles of membrane excitability. And that, my friends, is enough to impress at your next cocktail party.</p>
<p>Now, let’s talk about drugs. Oh boy, drugs. You know, those pesky little molecules that interfere with neuronal signaling? Well, guess what? They love to target these ion channels. Lidocaine? Blocks sodium channels, basically shutting down the neuron. Fun times! Potassium channel blockers? Well, let’s just say they can make neurons go wild. Our model? It can predict these effects, to a certain extent. Of course, it’s not exactly a perfect predictor of pharmacological outcomes. But hey, it’s a start.</p>
<p>And finally, let’s talk about the big picture. Communication. You know, how your brain actually <em>does</em> stuff? Well, it all starts with these action potentials. They’re like, the brain’s version of Morse code. But instead of dots and dashes, it’s a symphony of electrical impulses, traveling along axons and triggering the release of neurotransmitters. And our little model? It gives us a glimpse into this magical world of neuronal chatter.</p>
<div class="page-columns page-full"><p><img src="multipolar-neurons.jpg" class="img-fluid" style="width:100.0%"> </p><div class="no-row-height column-margin column-container"><span class="margin-aside">Motor Neurons (Multipolar) with many Processes (mostly Dendrites). Photo from <a href="https://www.neurologyadvisor.com/news/spinal-cord-gray-matter-atrophy-post-polio-syndrome-functional-decline/">Neurology Advisor</a></span></div></div>
</section>
<section id="hasta-la-vista-baby" class="level1 page-columns page-full">
<h1>Hasta la Vista Baby</h1>
<p>So, there you have it. Our “simplified” action potential model. Not exactly a perfect mirror of reality, but hey, it’s a good start. Now go forth and explore the wonders of neuroscience! Dive deeper into the hows and whys of ion channel behavior, uncover the secrets of synaptic transmission, and maybe even contribute to the next big breakthrough in neuroscience. The human brain is an incredibly complex machine, and understanding its workings is a journey of endless fascination.</p>
<div class="page-columns page-full"><p>Just remember, this is just the tip of the iceberg. Real neurons are far more sophisticated than our little model. They’re a tornado of activity, a symphony of ions, and a constant dance of electrical signals. But hey, at least now you have a basic understanding of how these amazing cells work. </p><div class="no-row-height column-margin column-container"><span class="margin-aside"><strong>Disclaimer</strong>: This model is for entertainment purposes only. Please do not attempt to perform any neurological procedures based on the information presented here (or maybe try it, but don’t mention my name).</span></div></div>
<p>Now go forth and amaze your friends with your newfound knowledge of neurophysiology. Just don’t get carried away and start diagnosing everyone with “abnormal neuronal activity.” And most importantly, remember to have fun! Neuroscience is a fascinating field, and there’s always something new to learn.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@misc{castillo-aguilar2025,
  author = {Castillo-Aguilar, Matías},
  title = {Decoding the {Neuron’s} {Spark:} {Building} {Intuition} for
    {Action} {Potential} {Dynamics}},
  date = {2025-01-06},
  url = {https://bayesically-speaking.com/posts/2025-01-06 simulating-action-potential/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-castillo-aguilar2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Castillo-Aguilar, Matías. 2025. <span>“Decoding the Neuron’s Spark:
Building Intuition for Action Potential Dynamics.”</span> January 6,
2025. <a href="https://bayesically-speaking.com/posts/2025-01-06 simulating-action-potential/">https://bayesically-speaking.com/posts/2025-01-06
simulating-action-potential/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/bayesically-speaking\.com\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="matcasti/Bayesically-Speaking" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->




</body></html>